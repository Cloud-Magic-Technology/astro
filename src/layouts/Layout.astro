---
import '../styles/global.css';
import { ViewTransitions } from 'astro:transitions';

interface Props {
	title?: string;
	description?: string;
}

const { title = 'Astro Exploration', description = 'Exploring Astro capabilities' } = Astro.props;

const currentPath = Astro.url.pathname;

const mainNav = [
	{ href: '/', label: 'Home' },
	{ href: '/evolution', label: 'Evolution' },
	{ href: '/playground', label: 'Playground' },
	{ href: '/performance', label: 'Performance' },
];

const demoNav = [
	{ href: '/state-sharing', label: 'State Sharing', desc: 'Cross-framework communication' },
	{ href: '/transitions', label: 'Transitions', desc: 'View Transitions API' },
	{ href: '/server-islands', label: 'Server Islands', desc: 'Dynamic + static mixing' },
	{ href: '/api-demo', label: 'API Demo', desc: 'Server endpoints' },
	{ href: '/content-power', label: 'Content Power', desc: 'MDX & Collections' },
];

const isActive = (href: string) => {
	if (href === '/') return currentPath === '/';
	return currentPath.startsWith(href);
};
---

<!doctype html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width" />
		<link rel="icon" type="image/svg+xml" href="/favicon.svg" />
		<link rel="icon" href="/favicon.ico" />
		<meta name="description" content={description} />
		<meta name="generator" content={Astro.generator} />
		<title>{title}</title>
		<ViewTransitions />
	</head>
	<body class="min-h-screen bg-slate-900 text-slate-100">
		<nav class="sticky top-0 z-50 border-b border-slate-700 bg-slate-800/95 backdrop-blur-sm">
			<div class="mx-auto max-w-5xl px-4 py-3">
				<div class="flex items-center justify-between">
					<a href="/" class="text-xl font-bold text-white hover:text-purple-400 transition-colors">
						Astro Lab
					</a>

					<!-- Desktop Navigation -->
					<div class="hidden items-center gap-1 md:flex">
						{mainNav.map((item) => (
							<a
								href={item.href}
								class={`rounded-lg px-3 py-2 text-sm font-medium transition-colors ${
									isActive(item.href)
										? 'bg-purple-500/20 text-purple-400'
										: 'text-slate-300 hover:bg-slate-700 hover:text-white'
								}`}
							>
								{item.label}
							</a>
						))}

						<!-- Demos Dropdown -->
						<div class="group relative">
							<button class="flex items-center gap-1 rounded-lg px-3 py-2 text-sm font-medium text-slate-300 transition-colors hover:bg-slate-700 hover:text-white">
								Demos
								<svg class="h-4 w-4 transition-transform group-hover:rotate-180" fill="none" viewBox="0 0 24 24" stroke="currentColor">
									<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
								</svg>
							</button>
							<div class="invisible absolute right-0 top-full w-64 pt-2 opacity-0 transition-all group-hover:visible group-hover:opacity-100">
								<div class="rounded-xl border border-slate-700 bg-slate-800 p-2 shadow-xl">
									{demoNav.map((item) => (
										<a
											href={item.href}
											class={`block rounded-lg px-3 py-2 transition-colors ${
												isActive(item.href)
													? 'bg-purple-500/20 text-purple-400'
													: 'hover:bg-slate-700'
											}`}
										>
											<span class="font-medium text-white">{item.label}</span>
											<span class="block text-xs text-slate-400">{item.desc}</span>
										</a>
									))}
								</div>
							</div>
						</div>

						<a
							href="/blog"
							class={`rounded-lg px-3 py-2 text-sm font-medium transition-colors ${
								isActive('/blog')
									? 'bg-purple-500/20 text-purple-400'
									: 'text-slate-300 hover:bg-slate-700 hover:text-white'
							}`}
						>
							Blog
						</a>
					</div>

					<!-- Mobile Menu Button -->
					<button id="mobile-menu-btn" class="rounded-lg p-2 text-slate-300 hover:bg-slate-700 md:hidden">
						<svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
							<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
						</svg>
					</button>
				</div>

				<!-- Mobile Navigation -->
				<div id="mobile-menu" class="hidden border-t border-slate-700 pt-3 mt-3 md:hidden">
					<div class="space-y-1">
						{mainNav.map((item) => (
							<a
								href={item.href}
								class={`block rounded-lg px-3 py-2 text-sm font-medium ${
									isActive(item.href)
										? 'bg-purple-500/20 text-purple-400'
										: 'text-slate-300 hover:bg-slate-700'
								}`}
							>
								{item.label}
							</a>
						))}
						<div class="border-t border-slate-700 my-2 pt-2">
							<span class="px-3 text-xs font-semibold uppercase tracking-wider text-slate-500">Demos</span>
						</div>
						{demoNav.map((item) => (
							<a
								href={item.href}
								class={`block rounded-lg px-3 py-2 text-sm ${
									isActive(item.href)
										? 'bg-purple-500/20 text-purple-400'
										: 'text-slate-300 hover:bg-slate-700'
								}`}
							>
								{item.label}
							</a>
						))}
						<div class="border-t border-slate-700 my-2 pt-2"></div>
						<a
							href="/blog"
							class={`block rounded-lg px-3 py-2 text-sm font-medium ${
								isActive('/blog')
									? 'bg-purple-500/20 text-purple-400'
									: 'text-slate-300 hover:bg-slate-700'
							}`}
						>
							Blog
						</a>
					</div>
				</div>
			</div>
		</nav>

		<script>
			const menuBtn = document.getElementById('mobile-menu-btn');
			const mobileMenu = document.getElementById('mobile-menu');

			menuBtn?.addEventListener('click', () => {
				mobileMenu?.classList.toggle('hidden');
			});
		</script>
		<main class="mx-auto max-w-5xl px-4 py-8">
			<slot />
		</main>
		<footer class="border-t border-slate-700 bg-slate-800 mt-auto">
			<div class="mx-auto max-w-5xl px-4 py-6">
				<div class="flex flex-col items-center justify-between gap-4 md:flex-row">
					<p class="text-sm text-slate-400">
						Built with Astro + React + Vue + Svelte + Tailwind
					</p>
					<div class="flex gap-4 text-sm text-slate-500">
						<a href="/evolution" class="hover:text-purple-400">Evolution</a>
						<a href="/playground" class="hover:text-purple-400">Playground</a>
						<a href="/performance" class="hover:text-purple-400">Performance</a>
					</div>
				</div>
			</div>
		</footer>
	</body>
</html>
